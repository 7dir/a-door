!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){AFRAME.registerComponent("door",{schema:{width:{type:"number",default:1},height:{type:"number",default:2},depth:{type:"number",default:.25},color:{type:"color",default:"#AAA"},texture:{type:"string",default:""},type:{type:"string",default:"simple"},state:{type:"string",default:"closed"},open_direction:{type:"string",default:"right"},open_duration:{type:"number",default:3e3},close_duration:{type:"number",default:3e3},open_event:{type:"string",default:"open"},close_event:{type:"string",default:"close"},open_sound:{type:"string",default:""},close_sound:{type:"string",default:""},auto_distance:{type:"number",default:0}},init:function(){var e=this.data,t=this.el;this.createDoor(e,t),this.eventOpenCloseHandler=function(e){var n=e.type;t.querySelectorAll("[sound]").forEach(function(e){e.emit(n,null,!1)}),t.querySelectorAll("a-box").forEach(function(e){e.emit(n,null,!1)})},this.teleportOpenCloseHandler=function(n){var o=new THREE.Vector3;o.setFromMatrixPosition(t.object3D.matrixWorld);var i=o.distanceTo(n.detail.newPosition);i<e.auto_distance&&"closed"===e.state?(e.state="open",t.emit("open")):i>e.auto_distance&&"open"===e.state&&(e.state="closed",t.emit("close"))},t.addEventListener(e.open_event,this.eventOpenCloseHandler),t.addEventListener(e.close_event,this.eventOpenCloseHandler),t.closest("a-scene").addEventListener("teleport",this.teleportOpenCloseHandler)},update:function(e){var t=this.data,n=this.el;0!==Object.keys(e).length&&(t.width===e.width&&t.height===e.height&&t.depth===e.depth||(n.getObject3D("mesh").geometry=new THREE.BoxBufferGeometry(t.width,t.height,t.depth)),t.color!==e.color&&(n.getObject3D("mesh").material.color=t.color),e.open_event&&t.open_event!==e.open_event&&n.removeEventListener(e.open_event,this.eventOpenCloseHandler),t.open_event&&n.addEventListener(t.open_event,this.eventOpenCloseHandler),e.close_event&&t.close_event!==e.close_event&&n.removeEventListener(e.close_event,this.eventOpenCloseHandler),t.close_event&&n.addEventListener(t.close_event,this.eventOpenCloseHandler))},remove:function(){this.el.removeObject3D("mesh")},open:function(){this.el.emit("open")},close:function(){this.el.emit("close")},createDoor:function(e,t){if(""!==e.open_sound){var n=document.createElement("a-entity");n.setAttribute("sound","src: "+e.open_sound+"; on: "+e.open_event),t.appendChild(n)}if(""!==e.close_sound){var o=document.createElement("a-entity");o.setAttribute("sound","src: "+e.close_sound+"; on: "+e.close_event),t.appendChild(o)}for(var i="double"===e.type?2:1,r=0;r<i;r++){var s=document.createElement("a-box");s.setAttribute("color",e.color),s.setAttribute("depth",e.depth),s.setAttribute("src",e.texture);var a=document.createElement("a-animation");a.setAttribute("attribute","position");var d=document.createElement("a-animation");d.setAttribute("attribute","position");var u=0===r?-1:1;if("right"===e.open_direction||"left"===e.open_direction){var l=e.width/i;s.setAttribute("height",e.height),s.setAttribute("width",l);var p=0;2===i&&(p=l/2*u);var c=p+" 0 0";s.setAttribute("position",c),a.setAttribute("from",c),this.setAnimationDuration(a,e.open_sound,e.open_duration),a.setAttribute("begin",e.open_event);var h=p;"right"===e.open_direction&&1===i||1===r&&2===i?h=p+l:("left"===e.open_direction&&1===i||0===r&&2===i)&&(h=p-l);var v=h+" 0 0";a.setAttribute("to",v),s.appendChild(a),this.setAnimationDuration(d,e.close_sound,e.close_duration),d.setAttribute("from",v),d.setAttribute("begin",e.close_event),d.setAttribute("to",c),s.appendChild(d)}else if("up"===e.open_direction||"down"===e.open_direction){var m=e.height/i;s.setAttribute("height",m),s.setAttribute("width",e.width);var p=0;2===i&&(p=m/2*u);var c="0 "+p+" 0";s.setAttribute("position",c),a.setAttribute("from",c),this.setAnimationDuration(a,e.open_sound,e.open_duration),a.setAttribute("begin",e.open_event);var _=p;"up"===e.open_direction&&1===i||1===r&&2===i?_=p+m:("down"===e.open_direction&&1===i||0===r&&2===i)&&(_=p-m);var v="0 "+_+" 0";a.setAttribute("to",v),s.appendChild(a),this.setAnimationDuration(d,e.close_sound,e.close_duration),d.setAttribute("from",v),d.setAttribute("begin",e.close_event),d.setAttribute("to",c),s.appendChild(d)}t.appendChild(s)}},setAnimationDuration:function(e,t,n){if(""!==t){var o=document.querySelector(t).duration;"undefined"!=typeof o&&(o=Math.trunc(1e3*o),e.setAttribute("dur",o))}else e.setAttribute("dur",n)}})}]);